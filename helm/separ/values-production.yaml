# Separ Authorization Platform - Production Values Example
# ============================================================================
# Copy this file and customize for your environment.
# DO NOT commit actual secrets or customer-specific values to the repository.
# ============================================================================

# =============================================================================
# Global Configuration
# =============================================================================
global:
  # Set to your private container registry
  imageRegistry: ""  # e.g., "myregistry.azurecr.io"
  imagePullSecrets:
    - name: registry-credentials

# =============================================================================
# Separ API Server
# =============================================================================
separ:
  replicaCount: 3
  
  image:
    repository: separ
    tag: ""  # Set to deployed version, e.g., "v1.0.0"
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8080
  
  ingress:
    enabled: false
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
  
  config:
    server:
      host: "0.0.0.0"
      port: 8080
    jwt:
      issuer: "separ"
      accessTokenExpirySecs: 3600
      refreshTokenExpirySecs: 2592000
  
  # Reference Kubernetes secrets - DO NOT put actual secrets here
  secrets:
    existingJwtSecret: "separ-secrets"
    jwtSecretKey: "jwt-secret"

# =============================================================================
# SpiceDB (Authorization Engine)
# =============================================================================
spicedb:
  enabled: true
  replicaCount: 3
  
  image:
    repository: spicedb  # Or "authzed/spicedb" for public registry
    tag: "v1.33.0"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  
  secrets:
    existingPresharedKeySecret: "separ-secrets"
    presharedKeySecretKey: "spicedb-preshared-key"

# =============================================================================
# PostgreSQL - Use Managed Database Service
# =============================================================================
postgresql:
  # Disable bundled PostgreSQL - use managed database
  enabled: false

# External PostgreSQL connection (for Separ metadata)
# Set actual values during deployment, NOT in this file
externalDatabase:
  host: ""  # Set during deployment
  port: 5432
  database: "separ"
  username: ""  # Set during deployment
  existingSecret: "separ-secrets"
  passwordKey: "postgres-password"
  sslMode: "require"

# External PostgreSQL for SpiceDB (can be same server, different database)
externalSpicedbDatabase:
  host: ""  # Set during deployment
  port: 5432
  database: "spicedb"
  username: ""  # Set during deployment
  existingSecret: "separ-secrets"
  passwordKey: "postgres-password"
  sslMode: "require"

# =============================================================================
# Network Policies (Security) - ENABLED
# =============================================================================
networkPolicy:
  enabled: true
  
  # Only allow access from approved namespaces
  allowedNamespaces: []
  # - name: my-app-namespace

# =============================================================================
# Service Account
# =============================================================================
serviceAccount:
  create: true
  annotations: {}
  # For cloud-specific identity federation, add annotations during deployment
  name: "separ"

# =============================================================================
# Pod Security - Strict
# =============================================================================
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# =============================================================================
# Monitoring
# =============================================================================
metrics:
  enabled: true
  serviceMonitor:
    enabled: false
    namespace: ""
    interval: 30s
