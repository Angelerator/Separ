# Separ Authorization Platform - Production Values
# ============================================================================
# Use this file for customer deployments in restricted networks
# ============================================================================

# =============================================================================
# Global Configuration
# =============================================================================
global:
  # Use Angelerator Docker Hub images (for restricted networks)
  imageRegistry: "docker.io"
  imagePullSecrets:
    - name: angelerator-registry

# =============================================================================
# Separ API Server
# =============================================================================
separ:
  replicaCount: 3
  
  image:
    # Angelerator Docker Hub repository
    repository: angelerator/separ
    tag: "v1.0.0"  # Set to deployed version
    pullPolicy: IfNotPresent
  
  service:
    type: ClusterIP
    port: 8080
  
  # No ingress - internal only
  ingress:
    enabled: false
  
  resources:
    requests:
      cpu: 200m
      memory: 256Mi
    limits:
      cpu: 1000m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
  
  config:
    server:
      host: "0.0.0.0"
      port: 8080
    
    jwt:
      issuer: "separ"
      accessTokenExpirySecs: 3600
      refreshTokenExpirySecs: 2592000
  
  # Use Kubernetes secrets
  secrets:
    existingJwtSecret: "separ-secrets"
    jwtSecretKey: "jwt-secret"

# =============================================================================
# SpiceDB (Authorization Engine)
# =============================================================================
spicedb:
  enabled: true
  replicaCount: 3
  
  image:
    repository: authzed/spicedb
    tag: "v1.33.0"
    pullPolicy: IfNotPresent
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 2000m
      memory: 2Gi
  
  secrets:
    existingPresharedKeySecret: "separ-secrets"
    presharedKeySecretKey: "spicedb-preshared-key"

# =============================================================================
# PostgreSQL - Use Azure Database for PostgreSQL
# =============================================================================
postgresql:
  # Disable bundled PostgreSQL - use managed database
  enabled: false

# External PostgreSQL connection
externalDatabase:
  host: "your-db-host.example.com"
  port: 5432
  database: "separ"
  username: "separ"
  # Use Kubernetes secret
  existingSecret: "separ-secrets"
  passwordKey: "postgres-password"
  sslMode: "require"

# =============================================================================
# Network Policies (Security) - ENABLED
# =============================================================================
networkPolicy:
  enabled: true
  
  # Only allow access from approved namespaces
  allowedNamespaces:
    - name: tavana
    # Add more approved app namespaces here

# =============================================================================
# Service Account with Azure Workload Identity
# =============================================================================
serviceAccount:
  create: true
  annotations:
    azure.workload.identity/client-id: ""  # Set during deployment
  name: "separ"

# =============================================================================
# Pod Security - Strict
# =============================================================================
podSecurityContext:
  fsGroup: 1000
  runAsNonRoot: true

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: true
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  seccompProfile:
    type: RuntimeDefault

# =============================================================================
# Monitoring
# =============================================================================
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: "monitoring"
    interval: 30s

